---
title: rabbitMQ面试题
abbrlink: 53587
date: 2022-04-07 15:42:12
tags:
---

# RabbitMQ

## 项目中用过消息队列么？你为啥用消息队列？

采用**微服务的设计思想**，**分布式的部署方式**，所以拆分了很多的服务，随着体量的增加以及业务场景越来越复杂了，很多场景单机的技术栈和中间件以及不够用了，而且对系统的友好性也下降了，最后做了很多技术选型的工作，我们决定引入**消息队列中间件**。

## 在什么场景用到了消息队列？

嗯，我从三个方面去说一下我使用的场景吧。**异步、削峰、解耦**

我们之前的场景里面有很多步骤都是在一个流程里面需要做完的，就比如说我的下单系统吧，本来我们业务简单，下单了付了钱就好了，流程就走完了。

但是后面来了个产品经理，搞了个**优惠券系统**，OK问题不大，流程里面多100ms去扣减优惠券。

后来产品经理灵光一闪说我们可以搞个**积分系统**啊，也行吧，流程里面多了200ms去增减积分。

再后来后来隔壁的产品老王说：下单成功后我们要给用户发短信，也将就吧，100ms去发个短信。

![img](https://s2.loli.net/2022/04/08/cbkHgYFsEeTRnM5.jpg)

这样的链路下去，整个系统时间就很长，用户体验很差

### 链路长了就慢了，那你怎么解决的？

那链路长了就慢了，但是我们发现上面的流程其实可以**同时做**的呀，你支付成功后，我去校验优惠券的同时我可以去增减积分啊，还可以同时发个短信啊。

那正常的流程我们是没办法实现的呀，怎么办，**异步**。

![img](https://s2.loli.net/2022/04/08/rmtT3IEyVRABKQv.jpg)

### 异步，那我用线程，线程池去做不是一样的么？

#### 解耦

因为用线程去做，带来的是代码量的增多

你一个订单流程，你扣积分，扣优惠券，发短信，扣库存。。。等等这么多业务要调用这么多的接口，**每次加一个你要调用一个接口然后还要重新发布系统**，写一次两次还好，写多了你就说：老子不干了！

你下单了，你就把你**支付成功的消息告诉别的系统**，他们收到了去处理就好了，你只用走完自己的流程，把自己的消息发出去，那后面要接入什么系统简单，直接订阅你发送的支付成功消息，你支付成功了我**监听就好了**。

![img](https://s2.loli.net/2022/04/08/qTY6iPKLy9pmrSt.jpg)

#### 削峰

你平时流量很低，但是你要做秒杀活动00 ：00的时候流量疯狂怼进来，你的服务器，**Redis**，**MySQL**各自的承受能力都不一样，你直接**全部流量照单全收**肯定有问题啊，直接就打挂了。

把请求放到队列里面，然后至于每秒消费多少请求，就看自己的**服务器处理能力**，你能处理5000QPS你就消费这么多，可能会比正常的慢一点，但是**不至于打挂服务器**，等流量高峰下去了，你的服务也就没压力了。

### 消息队列有啥问题么？

#### 系统复杂性

本来蛮简单的一个系统，我代码随便写都没事，现在你凭空接入一个中间件在那，我是不是要考虑去维护他，而且使用的过程中是不是要考虑各种问题，比如消息**重复消费**、**消息丢失**、**消息的顺序消费**等等，反正用了之后就是贼烦。

#### 数据一致性

这个其实是分布式服务本身就存在的一个问题，**不仅仅是消息队列的问题**，但是用了消息队列这个问题会暴露得比较严重一点。

**分布式事务**：把下单，优惠券，积分。。。都放在一个事务里面一样，要成功一起成功，要失败一起失败。

#### 可用性

你搞个系统本身没啥问题，你现在突然接入一个中间件在那放着，万一挂了怎么办？我下个单**MQ挂了**，优惠券不扣了，积分不减了。

## 技术选型为什么使用rabbitMQ

![img](https://s2.loli.net/2022/04/08/UjKt7ic3aInAOfN.jpg)

高可用，并发能力强，延时最低，不会丢失消息（不像ActiveMQ和kafka会丢失消息）社区活跃度高

